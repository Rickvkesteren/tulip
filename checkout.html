<!DOCTYPE html>
<html lang="nl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Afrekenen - Bollenstreek Bollen</title>
    <link rel="stylesheet" href="css/style.css">
    <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@400;600;700&family=Open+Sans:wght@300;400;600&display=swap" rel="stylesheet">
    <style>
        .checkout-page {
            padding: 40px 0;
            min-height: calc(100vh - 200px);
            background: var(--bg-light);
        }

        .checkout-grid {
            display: grid;
            grid-template-columns: 1fr 400px;
            gap: 40px;
            max-width: 1100px;
            margin: 0 auto;
        }

        .checkout-form-section {
            background: white;
            border-radius: var(--radius);
            padding: 30px;
            box-shadow: var(--shadow);
        }

        .checkout-form-section h2 {
            font-size: 1.3rem;
            margin-bottom: 25px;
            padding-bottom: 15px;
            border-bottom: 2px solid var(--bg-light);
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            font-weight: 600;
            margin-bottom: 8px;
            color: var(--text-dark);
        }

        .form-group input,
        .form-group select {
            width: 100%;
            padding: 12px 15px;
            border: 1px solid var(--border-color);
            border-radius: var(--radius-sm);
            font-size: 1rem;
            transition: var(--transition);
        }

        .form-group input:focus,
        .form-group select:focus {
            outline: none;
            border-color: var(--primary-color);
            box-shadow: 0 0 0 3px rgba(231, 76, 60, 0.1);
        }

        .checkout-summary {
            background: white;
            border-radius: var(--radius);
            padding: 30px;
            box-shadow: var(--shadow);
            position: sticky;
            top: 20px;
        }

        .checkout-summary h3 {
            font-size: 1.2rem;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 2px solid var(--bg-light);
        }

        .summary-items {
            max-height: 300px;
            overflow-y: auto;
            margin-bottom: 20px;
        }

        .summary-item {
            display: flex;
            gap: 15px;
            padding: 12px 0;
            border-bottom: 1px solid var(--bg-light);
        }

        .summary-item-icon {
            font-size: 2rem;
            width: 50px;
            height: 50px;
            display: flex;
            align-items: center;
            justify-content: center;
            background: var(--bg-light);
            border-radius: var(--radius-sm);
        }

        .summary-item-details {
            flex: 1;
        }

        .summary-item-name {
            font-weight: 600;
            margin-bottom: 4px;
        }

        .summary-item-meta {
            font-size: 0.85rem;
            color: var(--text-light);
        }

        .summary-item-price {
            font-weight: 600;
            color: var(--primary-color);
        }

        .summary-totals {
            padding: 15px 0;
            border-top: 2px solid var(--bg-light);
        }

        .summary-row {
            display: flex;
            justify-content: space-between;
            margin-bottom: 10px;
        }

        .summary-row.total {
            font-size: 1.3rem;
            font-weight: 700;
            padding-top: 10px;
            border-top: 1px solid var(--border-color);
            margin-top: 10px;
        }

        .summary-row.savings {
            color: #27ae60;
        }

        .payment-methods {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 10px;
            margin-bottom: 20px;
        }

        .payment-method {
            border: 2px solid var(--border-color);
            border-radius: var(--radius-sm);
            padding: 15px;
            text-align: center;
            cursor: pointer;
            transition: var(--transition);
        }

        .payment-method:hover,
        .payment-method.selected {
            border-color: var(--primary-color);
            background: rgba(231, 76, 60, 0.05);
        }

        .payment-method img {
            height: 30px;
            margin-bottom: 5px;
        }

        .payment-method span {
            display: block;
            font-size: 0.85rem;
        }

        .btn-checkout {
            width: 100%;
            padding: 15px;
            font-size: 1.1rem;
            background: var(--primary-color);
            color: white;
            border: none;
            border-radius: var(--radius-sm);
            cursor: pointer;
            font-weight: 600;
            transition: var(--transition);
        }

        .btn-checkout:hover {
            background: var(--primary-dark);
            transform: translateY(-2px);
        }

        .checkout-trust {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin-top: 20px;
            padding-top: 20px;
            border-top: 1px solid var(--bg-light);
        }

        .trust-item {
            text-align: center;
            font-size: 0.8rem;
            color: var(--text-light);
        }

        .trust-item span {
            display: block;
            font-size: 1.5rem;
            margin-bottom: 5px;
        }

        .leverancier-info {
            background: #f0f9ff;
            border: 1px solid #bee3f8;
            border-radius: var(--radius-sm);
            padding: 15px;
            margin-bottom: 20px;
        }

        .leverancier-info h4 {
            color: #2b6cb0;
            margin-bottom: 10px;
            font-size: 0.95rem;
        }

        .leverancier-badge {
            display: inline-flex;
            align-items: center;
            gap: 5px;
            background: white;
            padding: 5px 10px;
            border-radius: 15px;
            font-size: 0.8rem;
            margin-right: 5px;
            margin-bottom: 5px;
        }

        @media (max-width: 900px) {
            .checkout-grid {
                grid-template-columns: 1fr;
            }

            .checkout-summary {
                position: static;
            }

            .form-row {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <!-- Header -->
    <header class="header">
        <div class="container">
            <div class="header-content">
                <a href="index.html" class="logo">
                    <span class="logo-icon">üå∑</span>
                    <span class="logo-text">Bollenstreek Direct</span>
                </a>
                <div class="checkout-steps" style="display: flex; gap: 20px; color: var(--text-light);">
                    <span>üõí Winkelwagen</span>
                    <span>‚Üí</span>
                    <span style="color: var(--primary-color); font-weight: 600;">üìù Gegevens</span>
                    <span>‚Üí</span>
                    <span>üí≥ Betalen</span>
                </div>
            </div>
        </div>
    </header>

    <main class="checkout-page">
        <div class="container">
            <div class="checkout-grid">
                <!-- Checkout Form -->
                <div class="checkout-forms">
                    <section class="checkout-form-section">
                        <h2>üìç Bezorgadres</h2>
                        <form id="checkoutForm">
                            <div class="form-row">
                                <div class="form-group">
                                    <label for="firstName">Voornaam *</label>
                                    <input type="text" id="firstName" required>
                                </div>
                                <div class="form-group">
                                    <label for="lastName">Achternaam *</label>
                                    <input type="text" id="lastName" required>
                                </div>
                            </div>
                            <div class="form-group">
                                <label for="email">E-mailadres *</label>
                                <input type="email" id="email" required placeholder="voor bevestiging en track & trace">
                            </div>
                            <div class="form-group">
                                <label for="phone">Telefoonnummer</label>
                                <input type="tel" id="phone" placeholder="voor bezorger (optioneel)">
                            </div>
                            <div class="form-row">
                                <div class="form-group">
                                    <label for="street">Straat en huisnummer *</label>
                                    <input type="text" id="street" required>
                                </div>
                                <div class="form-group">
                                    <label for="addition">Toevoeging</label>
                                    <input type="text" id="addition" placeholder="b, 2e etage, etc.">
                                </div>
                            </div>
                            <div class="form-row">
                                <div class="form-group">
                                    <label for="postalCode">Postcode *</label>
                                    <input type="text" id="postalCode" required placeholder="1234 AB">
                                </div>
                                <div class="form-group">
                                    <label for="city">Plaats *</label>
                                    <input type="text" id="city" required>
                                </div>
                            </div>
                            <div class="form-group">
                                <label for="country">Land *</label>
                                <select id="country" required>
                                    <option value="NL" selected>Nederland</option>
                                    <option value="BE">Belgi√´</option>
                                    <option value="DE">Duitsland</option>
                                </select>
                            </div>
                        </form>
                    </section>

                    <section class="checkout-form-section" style="margin-top: 20px;">
                        <h2>üí≥ Betaalmethode</h2>
                        <p style="color: #7f8c8d; margin-bottom: 20px; font-size: 0.9rem;">Veilig betalen via Mollie - Kies je favoriete betaalmethode</p>
                        <div class="payment-methods">
                            <div class="payment-method selected" onclick="selectPayment(this, 'ideal')">
                                <div style="font-size: 2rem;">üè¶</div>
                                <span>iDEAL</span>
                            </div>
                            <div class="payment-method" onclick="selectPayment(this, 'bancontact')">
                                <div style="font-size: 2rem;">üí≥</div>
                                <span>Bancontact</span>
                            </div>
                            <div class="payment-method" onclick="selectPayment(this, 'creditcard')">
                                <div style="font-size: 2rem;">üí≥</div>
                                <span>Creditcard</span>
                            </div>
                            <div class="payment-method" onclick="selectPayment(this, 'paypal')">
                                <div style="font-size: 2rem;">üÖøÔ∏è</div>
                                <span>PayPal</span>
                            </div>
                            <div class="payment-method" onclick="selectPayment(this, 'klarna')">
                                <div style="font-size: 2rem;">üõçÔ∏è</div>
                                <span>Klarna</span>
                            </div>
                            <div class="payment-method" onclick="selectPayment(this, 'applepay')">
                                <div style="font-size: 2rem;">üçé</div>
                                <span>Apple Pay</span>
                            </div>
                        </div>

                        <div style="background: #f8f9fa; padding: 15px; border-radius: 10px; margin-top: 20px; display: flex; align-items: center; justify-content: center; gap: 10px;">
                            <span>üîí</span>
                            <span style="font-size: 0.9rem; color: #666;">Veilig betalen via</span>
                            <strong style="color: #000;">Mollie</strong>
                        </div>

                        <div class="leverancier-info" id="leverancierInfo">
                            <h4>üì¶ Uw bestelling wordt verzonden door:</h4>
                            <div id="leverancierBadges">
                                <!-- Filled by JS -->
                            </div>
                            <p style="font-size: 0.85rem; color: #4a5568; margin-top: 10px;">
                                Wij werken samen met gerenommeerde Nederlandse bollenkwekers. 
                                Uw bollen worden vers van de kweker verzonden.
                            </p>
                        </div>
                    </section>
                </div>

                <!-- Order Summary -->
                <div class="checkout-summary">
                    <h3>üõí Besteloverzicht</h3>
                    <div class="summary-items" id="summaryItems">
                        <!-- Filled by JS -->
                    </div>
                    
                    <div class="summary-totals">
                        <div class="summary-row">
                            <span>Subtotaal</span>
                            <span id="summarySubtotal">‚Ç¨0,00</span>
                        </div>
                        <div class="summary-row">
                            <span>Verzending</span>
                            <span id="summaryShipping">‚Ç¨0,00</span>
                        </div>
                        <div class="summary-row total">
                            <span>Totaal</span>
                            <span id="summaryTotal">‚Ç¨0,00</span>
                        </div>
                    </div>

                    <button class="btn-checkout" onclick="processCheckout()">
                        Bestelling Plaatsen ‚Üí
                    </button>

                    <div class="checkout-trust">
                        <div class="trust-item">
                            <span>üîí</span>
                            Veilig betalen
                        </div>
                        <div class="trust-item">
                            <span>üöö</span>
                            Snelle levering
                        </div>
                        <div class="trust-item">
                            <span>‚≠ê</span>
                            Topkwaliteit
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <script src="js/data.js"></script>
    <script src="js/cart.js"></script>
    <script>
        let selectedPayment = 'ideal';

        document.addEventListener('DOMContentLoaded', function() {
            loadCheckoutSummary();
            loadLeverancierInfo();
        });

        function loadCheckoutSummary() {
            const items = cart.items;
            const container = document.getElementById('summaryItems');
            
            if (items.length === 0) {
                window.location.href = 'shop.html';
                return;
            }

            container.innerHTML = items.map(item => {
                const product = products.find(p => p.id === item.productId);
                const kweker = getKwekerForProduct(product);
                return `
                    <div class="summary-item">
                        <div class="summary-item-icon">${product.icon}</div>
                        <div class="summary-item-details">
                            <div class="summary-item-name">${product.name}</div>
                            <div class="summary-item-meta">${item.quantity}x ${product.unit} ‚Ä¢ ${kweker.name}</div>
                        </div>
                        <div class="summary-item-price">${formatPrice(product.price * item.quantity)}</div>
                    </div>
                `;
            }).join('');

            // Update totals
            document.getElementById('summarySubtotal').textContent = formatPrice(cart.getTotal());
            document.getElementById('summaryShipping').textContent = cart.getShippingCost() === 0 
                ? 'GRATIS' 
                : formatPrice(cart.getShippingCost());
            document.getElementById('summaryTotal').textContent = formatPrice(cart.getTotalWithShipping());
        }

        function loadLeverancierInfo() {
            const grouped = groepeerBestellingPerLeverancier(cart.items);
            const container = document.getElementById('leverancierBadges');
            
            container.innerHTML = Object.values(grouped).map(group => `
                <span class="leverancier-badge">
                    üè≠ ${group.leverancier.name}
                </span>
            `).join('');
        }

        function selectPayment(element, method) {
            document.querySelectorAll('.payment-method').forEach(el => el.classList.remove('selected'));
            element.classList.add('selected');
            selectedPayment = method;
        }

        function processCheckout() {
            const form = document.getElementById('checkoutForm');
            if (!form.checkValidity()) {
                form.reportValidity();
                return;
            }

            // Collect order data
            const orderData = {
                customer: {
                    firstName: document.getElementById('firstName').value,
                    lastName: document.getElementById('lastName').value,
                    email: document.getElementById('email').value,
                    phone: document.getElementById('phone').value,
                    address: {
                        street: document.getElementById('street').value,
                        addition: document.getElementById('addition').value,
                        postalCode: document.getElementById('postalCode').value,
                        city: document.getElementById('city').value,
                        country: document.getElementById('country').value
                    }
                },
                items: cart.items,
                payment: selectedPayment,
                totals: {
                    subtotal: cart.getTotal(),
                    shipping: cart.getShippingCost(),
                    total: cart.getTotalWithShipping()
                },
                leveranciersOrders: groepeerBestellingPerLeverancier(cart.items),
                marge: berekenTotaleMarge(cart.items)
            };

            // Log order (in productie zou dit naar een backend gaan)
            console.log('=== NIEUWE BESTELLING ===');
            console.log(orderData);
            console.log('=== LEVERANCIERS ORDERS ===');
            Object.values(orderData.leveranciersOrders).forEach(group => {
                console.log(genereerLeveranciersOrder(group));
            });
            console.log('=== MARGE INFO ===');
            console.log(`Totale marge: ${formatPrice(orderData.marge.totaleMarge)} (${orderData.marge.margePercentage}%)`);

            // Simuleer succesvolle bestelling
            alert(`Bedankt voor uw bestelling, ${orderData.customer.firstName}!\n\nUw bloembollen worden vers verzonden door onze kwekers.\n\nU ontvangt een bevestiging op ${orderData.customer.email}`);
            
            // Clear cart
            cart.clear();
            
            // Redirect to confirmation
            window.location.href = 'index.html';
        }
    </script>
</body>
</html>
