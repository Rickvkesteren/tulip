<!DOCTYPE html>
<html lang="nl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>De Bollenstreek - Bollenstreek Direct</title>
    <link rel="stylesheet" href="css/style.css">
    <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@400;600;700&family=Open+Sans:wght@300;400;600&display=swap" rel="stylesheet">
    <!-- Leaflet CSS -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY=" crossorigin=""/>
    <style>
        #map {
            height: 500px;
            width: 100%;
            border-radius: 12px;
            z-index: 1;
        }
        
        /* Legenda Styling */
        .map-legend {
            display: flex;
            justify-content: center;
            gap: 15px;
            flex-wrap: wrap;
            margin-bottom: 20px;
            padding: 15px;
            background: white;
            border-radius: 12px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        
        .legend-item {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 10px 20px;
            border-radius: 25px;
            cursor: pointer;
            transition: all 0.3s ease;
            border: 2px solid transparent;
            font-weight: 500;
            font-size: 0.9rem;
        }
        
        .legend-item.active {
            border-color: currentColor;
            box-shadow: 0 2px 8px rgba(0,0,0,0.15);
        }
        
        .legend-item:not(.active) {
            opacity: 0.5;
        }
        
        .legend-item:hover {
            transform: translateY(-2px);
        }
        
        .legend-item.kwekers {
            background: #ffe5e5;
            color: #e74c3c;
        }
        
        .legend-item.experiences {
            background: #e5f0ff;
            color: #3498db;
        }
        
        .legend-item.plaatsen {
            background: #e5ffe5;
            color: #27ae60;
        }
        
        .legend-icon {
            font-size: 1.2rem;
        }
        
        .legend-count {
            background: rgba(0,0,0,0.1);
            padding: 2px 8px;
            border-radius: 10px;
            font-size: 0.75rem;
        }

        .leaflet-popup-content {
            font-family: 'Open Sans', sans-serif;
        }
        .popup-kweker {
            text-align: center;
            min-width: 200px;
        }
        .popup-kweker h3 {
            font-family: 'Playfair Display', serif;
            margin: 0 0 5px 0;
            color: #2c3e50;
        }
        .popup-kweker .location {
            color: #7f8c8d;
            font-size: 0.9rem;
            margin-bottom: 10px;
        }
        .popup-kweker .specialties {
            display: flex;
            flex-wrap: wrap;
            gap: 5px;
            justify-content: center;
            margin-bottom: 10px;
        }
        .popup-kweker .specialty {
            background: #f0f0f0;
            padding: 3px 8px;
            border-radius: 10px;
            font-size: 0.75rem;
        }
        .popup-kweker .btn-small {
            display: inline-block;
            background: #e74c3c;
            color: white;
            padding: 8px 15px;
            border-radius: 6px;
            text-decoration: none;
            font-size: 0.85rem;
            margin-top: 5px;
        }
        .popup-kweker .btn-small:hover {
            background: #c0392b;
        }
        .partner-webshops {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 20px;
            margin-top: 30px;
        }
        .partner-card {
            background: white;
            border-radius: 12px;
            padding: 25px;
            box-shadow: 0 2px 15px rgba(0,0,0,0.1);
            transition: all 0.3s ease;
        }
        .partner-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 30px rgba(0,0,0,0.15);
        }
        .partner-card h4 {
            margin: 0 0 5px 0;
            font-size: 1.2rem;
        }
        .partner-card .location {
            color: #7f8c8d;
            font-size: 0.9rem;
            margin-bottom: 10px;
        }
        .partner-card p {
            color: #7f8c8d;
            margin-bottom: 15px;
        }
        .partner-card .specialties {
            display: flex;
            flex-wrap: wrap;
            gap: 5px;
            margin-bottom: 15px;
        }
        .partner-card .specialty {
            background: #f5f5f5;
            padding: 4px 10px;
            border-radius: 15px;
            font-size: 0.8rem;
        }
        .partner-card a.visit-btn {
            display: inline-block;
            background: #27ae60;
            color: white;
            padding: 10px 20px;
            border-radius: 8px;
            text-decoration: none;
            font-weight: 600;
            transition: all 0.3s ease;
        }
        .partner-card a.visit-btn:hover {
            background: #219a52;
        }
    </style>
</head>
<body>
    <!-- Header -->
    <header class="header">
        <div class="container">
            <div class="header-content">
                <a href="index.html" class="logo">
                    <span class="logo-icon">üå∑</span>
                    <span class="logo-text">Bollenstreek Direct</span>
                </a>
                <nav class="nav">
                    <a href="index.html" class="nav-link">Home</a>
                    <a href="shop.html" class="nav-link">Webshop</a>
                    <a href="kwekers.html" class="nav-link">Onze Kwekers</a>
                    <a href="bollenstreek.html" class="nav-link active">De Bollenstreek</a>
                    <a href="experiences.html" class="nav-link">Experiences</a>
                    <a href="blog.html" class="nav-link">Blog</a>
                    <a href="contact.html" class="nav-link">Contact</a>
                </nav>
                <div class="header-actions">
                    <div class="search-box">
                        <input type="text" id="searchInput" placeholder="Zoek bloembollen..." autocomplete="off">
                        <div class="search-results" id="searchResults"></div>
                    </div>
                    <button class="fav-btn" id="favBtn" title="Favorieten">
                        ‚ù§Ô∏è <span class="fav-count" id="favCount">0</span>
                    </button>
                    <button class="cart-btn" id="cartBtn">
                        üõí <span class="cart-count" id="cartCount">0</span>
                    </button>
                </div>
            </div>
        </div>
    </header>

    <!-- Page Header -->
    <section class="page-header">
        <div class="container">
            <h1>De Bollenstreek</h1>
            <p>Ontdek waar onze bloembollen vandaan komen</p>
        </div>
    </section>

    <!-- Bollenstreek Section -->
    <section class="bollenstreek-section">
        <div class="container">
            <div class="bollenstreek-intro">
                <p>
                    De Bollenstreek is een prachtig gebied tussen Leiden en Haarlem, wereldberoemd om de kleurrijke 
                    bloembollenvelden die elk voorjaar tot bloei komen. Dit unieke stukje Nederland is al eeuwenlang 
                    het centrum van de Nederlandse bloembollenteelt.
                </p>
            </div>

            <!-- Interactive Map -->
            <div class="map-fullwidth">
                <h3 style="text-align: center; margin-bottom: 20px; font-size: 1.5rem;">üó∫Ô∏è Interactieve Kaart</h3>
                
                <!-- Live Bloei Status Banner -->
                <div id="bloomStatusBanner" style="background: linear-gradient(135deg, #e8f5e9 0%, #c8e6c9 100%); padding: 15px 25px; border-radius: 12px; margin-bottom: 20px; display: flex; align-items: center; justify-content: space-between; flex-wrap: wrap; gap: 15px;">
                    <div style="display: flex; align-items: center; gap: 15px;">
                        <div class="bloom-indicator active"></div>
                        <div>
                            <strong style="color: #2e7d32;">üå∑ Live Bloei Status</strong>
                            <p style="margin: 0; font-size: 0.9rem; color: #558b2f;" id="bloomStatusText">Laadt bloei informatie...</p>
                        </div>
                    </div>
                    <div class="best-visit-badge" id="bestVisitBadge">
                        ‚≠ê Beste bezoektijd: <span id="bestVisitTime">-</span>
                    </div>
                </div>
                
                <!-- Legenda met filters -->
                <div class="map-legend" id="mapLegend">
                    <div class="legend-item kwekers active" data-filter="kwekers" onclick="toggleFilter('kwekers')">
                        <span class="legend-icon">üå∑</span>
                        <span>Bloembollen Bedrijven</span>
                        <span class="legend-count" id="count-kwekers">20</span>
                    </div>
                    <div class="legend-item experiences active" data-filter="experiences" onclick="toggleFilter('experiences')">
                        <span class="legend-icon">üéâ</span>
                        <span>Uitjes & Experiences</span>
                        <span class="legend-count" id="count-experiences">12</span>
                    </div>
                    <div class="legend-item plaatsen active" data-filter="plaatsen" onclick="toggleFilter('plaatsen')">
                        <span class="legend-icon">üìç</span>
                        <span>Plaatsen</span>
                        <span class="legend-count" id="count-plaatsen">6</span>
                    </div>
                </div>
                
                <!-- Route Planner -->
                <div class="route-planner" id="routePlanner">
                    <h3>üö¥ Route Planner</h3>
                    <p style="color: var(--text-light); margin-bottom: 15px;">Plan je eigen route langs de mooiste bollenkwekers en bezienswaardigheden.</p>
                    
                    <div class="route-type-toggle">
                        <button class="route-type-btn active" onclick="setRouteType('bike')" id="btnBike">
                            üö¥ Fietsroute
                        </button>
                        <button class="route-type-btn" onclick="setRouteType('car')" id="btnCar">
                            üöó Autoroute
                        </button>
                        <button class="route-type-btn" onclick="setRouteType('walk')" id="btnWalk">
                            üö∂ Wandelroute
                        </button>
                    </div>
                    
                    <div class="route-stops" id="routeStops">
                        <p style="text-align: center; color: var(--text-light); padding: 20px;">
                            Klik op markers in de kaart om stops toe te voegen aan je route
                        </p>
                    </div>
                    
                    <div class="route-summary" id="routeSummary" style="display: none;">
                        <div class="route-stats">
                            <div class="route-stat">
                                <div class="value" id="routeDistance">0 km</div>
                                <div class="label">Afstand</div>
                            </div>
                            <div class="route-stat">
                                <div class="value" id="routeTime">0 min</div>
                                <div class="label">Geschatte tijd</div>
                            </div>
                            <div class="route-stat">
                                <div class="value" id="routeStopsCount">0</div>
                                <div class="label">Stops</div>
                            </div>
                        </div>
                        <button class="btn btn-primary" onclick="exportRoute()" style="width: 100%;">
                            üì• Download Route (GPX)
                        </button>
                    </div>
                    
                    <button class="btn btn-secondary" onclick="clearRoute()" style="width: 100%; margin-top: 10px;">
                        üóëÔ∏è Route Wissen
                    </button>
                </div>
                
                <div id="map"></div>
            </div>

            <!-- Partner Webshops Section -->
            <div style="margin: 60px 0;">
                <h2 style="text-align: center; font-size: 2rem; margin-bottom: 15px;">üõí Partner Webshops</h2>
                <p style="text-align: center; color: #7f8c8d; max-width: 700px; margin: 0 auto 30px;">
                    Bestel rechtstreeks bij onze partner kwekerijen. Klik op een webshop om hun assortiment te bekijken.
                </p>
                <div class="partner-webshops" id="partnerWebshops">
                    <!-- Dynamisch geladen -->
                </div>
            </div>

            <!-- Locations Grid -->
            <h3 style="text-align: center; margin-bottom: 30px; font-size: 1.8rem;">üìç Locaties in de Bollenstreek</h3>
            <div class="locations-grid" id="locationsGrid">
                <!-- Dynamisch gegenereerd -->
            </div>
        </div>
    </section>

    <!-- Virtual Tours / 360¬∞ Views Section -->
    <section style="padding: 80px 0; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);">
        <div class="container">
            <h2 style="text-align: center; color: white; margin-bottom: 15px;">üåê Virtuele Rondleidingen & 360¬∞ Views</h2>
            <p style="text-align: center; color: rgba(255,255,255,0.9); max-width: 700px; margin: 0 auto 40px;">
                Beleef de Bollenstreek vanuit huis! Bekijk 360¬∞ panorama's van de mooiste bollenvelden.
            </p>
            
            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 25px;">
                <div class="virtual-tour-card">
                    <div class="tour-preview" style="background: linear-gradient(135deg, #e74c3c 0%, #c0392b 100%);">
                        <div class="tour-360-badge">üîÑ 360¬∞ View</div>
                    </div>
                    <div class="tour-info">
                        <h4>üå∑ Tulpenvelden Lisse</h4>
                        <p>Panoramisch uitzicht over de iconische tulpenvelden nabij Keukenhof</p>
                        <button class="btn btn-primary" style="width: 100%; margin-top: 15px;" onclick="showToast('360¬∞ view komt binnenkort beschikbaar!', 'info')">
                            Bekijk 360¬∞ ‚Üí
                        </button>
                    </div>
                </div>
                
                <div class="virtual-tour-card">
                    <div class="tour-preview" style="background: linear-gradient(135deg, #f1c40f 0%, #f39c12 100%);">
                        <div class="tour-360-badge">üîÑ 360¬∞ View</div>
                    </div>
                    <div class="tour-info">
                        <h4>üåº Narcissenvelden Noordwijk</h4>
                        <p>Ontdek de gele zee van narcissen richting de kust</p>
                        <button class="btn btn-primary" style="width: 100%; margin-top: 15px;" onclick="showToast('360¬∞ view komt binnenkort beschikbaar!', 'info')">
                            Bekijk 360¬∞ ‚Üí
                        </button>
                    </div>
                </div>
                
                <div class="virtual-tour-card">
                    <div class="tour-preview" style="background: linear-gradient(135deg, #9b59b6 0%, #8e44ad 100%);">
                        <div class="tour-360-badge">üîÑ 360¬∞ View</div>
                    </div>
                    <div class="tour-info">
                        <h4>üíú Hyacintenvelden Hillegom</h4>
                        <p>Ruik de heerlijke geur (virtueel!) van duizenden hyacinten</p>
                        <button class="btn btn-primary" style="width: 100%; margin-top: 15px;" onclick="showToast('360¬∞ view komt binnenkort beschikbaar!', 'info')">
                            Bekijk 360¬∞ ‚Üí
                        </button>
                    </div>
                </div>
                
                <div class="virtual-tour-card">
                    <div class="tour-preview" style="background: linear-gradient(135deg, #27ae60 0%, #2ecc71 100%);">
                        <div class="tour-360-badge">üé¨ Video Tour</div>
                    </div>
                    <div class="tour-info">
                        <h4>üöÅ Drone Vlucht Bollenstreek</h4>
                        <p>Spectaculaire luchtbeelden van de hele Bollenstreek</p>
                        <button class="btn btn-primary" style="width: 100%; margin-top: 15px;" onclick="showToast('Video tour komt binnenkort beschikbaar!', 'info')">
                            Bekijk Video ‚Üí
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Info Section -->
    <section style="padding: 80px 0; background: var(--bg-cream);">
        <div class="container">
            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 60px; align-items: center;">
                <div>
                    <h2 style="font-size: 2rem; margin-bottom: 20px;">Waarom de Bollenstreek?</h2>
                    <p style="color: #7f8c8d; margin-bottom: 15px; line-height: 1.8;">
                        De unieke combinatie van zandige grond, het zeeklimaat en eeuwenoude expertise maakt de 
                        Bollenstreek de perfecte plek voor het kweken van bloembollen.
                    </p>
                    <ul style="color: #7f8c8d; line-height: 2; list-style: none;">
                        <li>üåä <strong>Zeeklimaat:</strong> Milde winters en koele zomers</li>
                        <li>üèñÔ∏è <strong>Zandgrond:</strong> Perfecte drainage voor bollen</li>
                        <li>üë®‚Äçüåæ <strong>Expertise:</strong> Generaties van kennis en ervaring</li>
                        <li>üå∑ <strong>Traditie:</strong> Al sinds de 17e eeuw bollenteelt</li>
                    </ul>
                </div>
                <div style="background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%); border-radius: 12px; padding: 60px; text-align: center;">
                    <div style="font-size: 6rem; margin-bottom: 20px;">üå∑üå∏üåº</div>
                    <h3 style="margin-bottom: 10px;">Het Voorjaar in de Bollenstreek</h3>
                    <p style="color: #7f8c8d;">Van half maart tot half mei kleuren de velden in alle kleuren van de regenboog.</p>
                </div>
            </div>
        </div>
    </section>

    <!-- History Section -->
    <section style="padding: 80px 0;">
        <div class="container">
            <h2 style="text-align: center; font-size: 2rem; margin-bottom: 50px;">Geschiedenis van de Bollenteelt</h2>
            <div style="display: grid; grid-template-columns: repeat(4, 1fr); gap: 30px;">
                <div style="text-align: center; padding: 30px;">
                    <div style="font-size: 2.5rem; color: var(--primary-color); font-weight: 700; margin-bottom: 10px;">1593</div>
                    <h4 style="margin-bottom: 10px;">De Eerste Tulpen</h4>
                    <p style="color: #7f8c8d; font-size: 0.9rem;">Carolus Clusius introduceert tulpen in Nederland vanuit Turkije.</p>
                </div>
                <div style="text-align: center; padding: 30px;">
                    <div style="font-size: 2.5rem; color: var(--primary-color); font-weight: 700; margin-bottom: 10px;">1637</div>
                    <h4 style="margin-bottom: 10px;">Tulpenmanie</h4>
                    <p style="color: #7f8c8d; font-size: 0.9rem;">De beroemde speculatiezeepbel rond tulpenbollen.</p>
                </div>
                <div style="text-align: center; padding: 30px;">
                    <div style="font-size: 2.5rem; color: var(--primary-color); font-weight: 700; margin-bottom: 10px;">1949</div>
                    <h4 style="margin-bottom: 10px;">Keukenhof Geopend</h4>
                    <p style="color: #7f8c8d; font-size: 0.9rem;">De wereldberoemde bloementuin opent haar deuren in Lisse.</p>
                </div>
                <div style="text-align: center; padding: 30px;">
                    <div style="font-size: 2.5rem; color: var(--primary-color); font-weight: 700; margin-bottom: 10px;">Nu</div>
                    <h4 style="margin-bottom: 10px;">Wereldexport</h4>
                    <p style="color: #7f8c8d; font-size: 0.9rem;">Nederland exporteert jaarlijks miljarden bloembollen wereldwijd.</p>
                </div>
            </div>
        </div>
    </section>

    <!-- Footer -->
    <footer class="footer">
        <div class="container">
            <div class="footer-grid">
                <div class="footer-col">
                    <h4>Bollenstreek Direct</h4>
                    <p>Nederlandse bloembollen rechtstreeks van lokale kwekers uit de Bollenstreek naar uw tuin.</p>
                </div>
                <div class="footer-col">
                    <h4>Webshop</h4>
                    <ul>
                        <li><a href="shop.html">Alle Producten</a></li>
                        <li><a href="shop.html?cat=tulpen">Tulpen</a></li>
                        <li><a href="shop.html?cat=narcissen">Narcissen</a></li>
                        <li><a href="shop.html?cat=hyacinten">Hyacinten</a></li>
                    </ul>
                </div>
                <div class="footer-col">
                    <h4>Over Ons</h4>
                    <ul>
                        <li><a href="kwekers.html">Onze Kwekers</a></li>
                        <li><a href="bollenstreek.html">De Bollenstreek</a></li>
                        <li><a href="contact.html">Contact</a></li>
                    </ul>
                </div>
                <div class="footer-col">
                    <h4>Contact</h4>
                    <p>üìç Bollenstreek, Nederland</p>
                    <p>üìß info@bollenstreekdirect.nl</p>
                    <p>üìû +31 (0)252 123 456</p>
                </div>
            </div>
            <div class="footer-bottom">
                <p>&copy; 2024 Bollenstreek Direct. Alle rechten voorbehouden.</p>
            </div>
        </div>
    </footer>

    <!-- Cart Sidebar -->
    <div class="cart-sidebar" id="cartSidebar">
        <div class="cart-header">
            <h3>üõí Winkelwagen</h3>
            <button class="cart-close" id="cartClose">‚úï</button>
        </div>
        <div class="cart-items" id="cartItems"></div>
        <div class="cart-footer">
            <div class="cart-subtotal">
                <span>Subtotaal:</span>
                <span id="cartTotal">‚Ç¨0,00</span>
            </div>
            <div id="shippingInfo" class="shipping-info"></div>
            <div class="cart-total-final">
                <span>Totaal:</span>
                <span id="cartTotalFinal">‚Ç¨0,00</span>
            </div>
            <button class="btn btn-primary btn-full" onclick="window.location.href='checkout.html'">Afrekenen ‚Üí</button>
            <p class="cart-secure">üîí Veilig betalen via iDEAL, Bancontact of creditcard</p>
        </div>
    </div>
    <div class="cart-overlay" id="cartOverlay"></div>

    <script src="js/data.js"></script>
    <script src="js/cart.js"></script>
    <script src="js/main.js"></script>
    <!-- Leaflet JS -->
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js" integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo=" crossorigin=""></script>
    <script>
        // Globale variabelen voor kaart en markers
        let map;
        let kwekerMarkers = [];
        let experienceMarkers = [];
        let plaatsMarkers = [];
        let activeFilters = {
            kwekers: true,
            experiences: true,
            plaatsen: true
        };

        document.addEventListener('DOMContentLoaded', function() {
            initMap();
            loadPartnerWebshops();
            loadLocations();
            updateCounts();
        });

        function updateCounts() {
            document.getElementById('count-kwekers').textContent = kwekers.length;
            document.getElementById('count-experiences').textContent = typeof experiences !== 'undefined' ? experiences.length : 0;
            document.getElementById('count-plaatsen').textContent = locations.length;
        }

        function toggleFilter(filterType) {
            activeFilters[filterType] = !activeFilters[filterType];
            
            // Update legenda styling
            const legendItem = document.querySelector(`.legend-item.${filterType}`);
            if (legendItem) {
                legendItem.classList.toggle('active', activeFilters[filterType]);
            }
            
            // Update markers zichtbaarheid
            updateMarkerVisibility();
        }

        function updateMarkerVisibility() {
            // Kwekers
            kwekerMarkers.forEach(marker => {
                if (activeFilters.kwekers) {
                    marker.addTo(map);
                } else {
                    map.removeLayer(marker);
                }
            });
            
            // Experiences
            experienceMarkers.forEach(marker => {
                if (activeFilters.experiences) {
                    marker.addTo(map);
                } else {
                    map.removeLayer(marker);
                }
            });
            
            // Plaatsen
            plaatsMarkers.forEach(marker => {
                if (activeFilters.plaatsen) {
                    marker.addTo(map);
                } else {
                    map.removeLayer(marker);
                }
            });
        }

        function initMap() {
            // Initialiseer Leaflet kaart gecentreerd op de Bollenstreek
            map = L.map('map').setView([52.35, 4.65], 9);

            // Voeg OpenStreetMap tiles toe
            L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
                maxZoom: 19,
                attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'
            }).addTo(map);

            // 1. Voeg markers toe voor elke kweker (ROOD)
            kwekers.forEach(kweker => {
                const marker = L.marker([kweker.coordinates.lat, kweker.coordinates.lng], {
                    icon: L.divIcon({
                        className: 'custom-marker',
                        html: `<div style="background: ${kweker.color || '#e74c3c'}; width: 40px; height: 40px; border-radius: 50% 50% 50% 0; transform: rotate(-45deg); display: flex; align-items: center; justify-content: center; box-shadow: 0 3px 10px rgba(0,0,0,0.3); border: 3px solid white;"><span style="transform: rotate(45deg); font-size: 20px;">${kweker.avatar}</span></div>`,
                        iconSize: [40, 40],
                        iconAnchor: [20, 40],
                        popupAnchor: [0, -40]
                    })
                });

                const popupContent = `
                    <div class="popup-kweker">
                        <div style="font-size: 2rem; margin-bottom: 5px;">${kweker.avatar}</div>
                        <h3>${kweker.name}</h3>
                        <div class="location">üìç ${kweker.location}</div>
                        <div class="specialties">
                            ${kweker.specialties.map(s => `<span class="specialty">${s}</span>`).join('')}
                        </div>
                        <div style="font-size: 0.85rem; color: #7f8c8d; margin-bottom: 10px;">
                            Sinds ${kweker.since} ‚Ä¢ ‚≠ê ${kweker.rating}
                        </div>
                        <div style="display: flex; gap: 5px; flex-wrap: wrap; justify-content: center;">
                            ${kweker.website ? `<a href="${kweker.website}" target="_blank" class="btn-small">üåê Website</a>` : ''}
                            <button class="btn-small" style="background: #27ae60;" onclick="addToRoute('${kweker.name.replace(/'/g, "\\'")}', ${kweker.coordinates.lat}, ${kweker.coordinates.lng}, '${kweker.avatar}')">‚ûï Route</button>
                        </div>
                    </div>
                `;

                marker.bindPopup(popupContent);
                marker.addTo(map);
                kwekerMarkers.push(marker);
            });

            // 2. Voeg markers toe voor experiences (BLAUW)
            if (typeof experiences !== 'undefined') {
                experiences.forEach(exp => {
                    const marker = L.marker([exp.coordinates.lat, exp.coordinates.lng], {
                        icon: L.divIcon({
                            className: 'custom-marker',
                            html: `<div style="background: ${exp.color || '#3498db'}; width: 36px; height: 36px; border-radius: 50% 50% 50% 0; transform: rotate(-45deg); display: flex; align-items: center; justify-content: center; box-shadow: 0 3px 10px rgba(0,0,0,0.3); border: 3px solid white;"><span style="transform: rotate(45deg); font-size: 18px;">${exp.icon}</span></div>`,
                            iconSize: [36, 36],
                            iconAnchor: [18, 36],
                            popupAnchor: [0, -36]
                        })
                    });

                    const popupContent = `
                        <div class="popup-kweker">
                            <div style="font-size: 2rem; margin-bottom: 5px;">${exp.icon}</div>
                            <h3>${exp.name}</h3>
                            <div class="location">üìç ${exp.location}</div>
                            <div style="background: #e5f0ff; color: #3498db; display: inline-block; padding: 3px 10px; border-radius: 10px; font-size: 0.75rem; margin-bottom: 8px;">${exp.type}</div>
                            <p style="font-size: 0.85rem; color: #7f8c8d; margin-bottom: 8px;">${exp.description.substring(0, 100)}...</p>
                            <div style="font-size: 0.85rem; color: #7f8c8d; margin-bottom: 10px;">
                                üí∞ ${exp.price} ‚Ä¢ ‚≠ê ${exp.rating}
                            </div>
                            <div style="display: flex; gap: 5px; flex-wrap: wrap; justify-content: center;">
                                ${exp.website ? `<a href="${exp.website}" target="_blank" class="btn-small" style="background: #3498db;">üé´ Info</a>` : ''}
                                <button class="btn-small" style="background: #27ae60;" onclick="addToRoute('${exp.name.replace(/'/g, "\\'")}', ${exp.coordinates.lat}, ${exp.coordinates.lng}, '${exp.icon}')">‚ûï Route</button>
                            </div>
                        </div>
                    `;

                    marker.bindPopup(popupContent);
                    marker.addTo(map);
                    experienceMarkers.push(marker);
                });
            }

            // 3. Voeg markers toe voor plaatsen (GROEN)
            locations.forEach(loc => {
                const marker = L.marker([loc.coordinates.lat, loc.coordinates.lng], {
                    icon: L.divIcon({
                        className: 'custom-marker',
                        html: `<div style="background: #27ae60; width: 30px; height: 30px; border-radius: 50%; display: flex; align-items: center; justify-content: center; box-shadow: 0 2px 8px rgba(0,0,0,0.2); border: 2px solid white;"><span style="font-size: 14px;">${loc.icon}</span></div>`,
                        iconSize: [30, 30],
                        iconAnchor: [15, 15],
                        popupAnchor: [0, -15]
                    })
                });

                marker.bindPopup(`
                    <div style="text-align: center; min-width: 150px;">
                        <div style="font-size: 1.5rem;">${loc.icon}</div>
                        <strong>${loc.name}</strong>
                        <p style="color: #7f8c8d; font-size: 0.85rem; margin: 5px 0;">${loc.description}</p>
                        <small style="color: #27ae60;">${loc.kwekers} kweker(s) actief</small>
                    </div>
                `);
                
                marker.addTo(map);
                plaatsMarkers.push(marker);
            });

            // Zoom to fit all markers
            const allCoords = [
                ...kwekers.map(k => [k.coordinates.lat, k.coordinates.lng]),
                ...(typeof experiences !== 'undefined' ? experiences.map(e => [e.coordinates.lat, e.coordinates.lng]) : []),
                ...locations.map(l => [l.coordinates.lat, l.coordinates.lng])
            ];
            if (allCoords.length > 0) {
                const bounds = L.latLngBounds(allCoords);
                map.fitBounds(bounds, { padding: [30, 30] });
            }
        }

        function loadPartnerWebshops() {
            const container = document.getElementById('partnerWebshops');
            if (!container) return;

            container.innerHTML = partnerWebshops.map(shop => `
                <div class="partner-card">
                    <h4>${shop.name}</h4>
                    <div class="location">üìç ${shop.location}</div>
                    <p>${shop.description}</p>
                    <div class="specialties">
                        ${shop.specialties.map(s => `<span class="specialty">${s}</span>`).join('')}
                    </div>
                    <a href="${shop.url}" target="_blank" rel="noopener" class="visit-btn">üõí Bezoek Webshop</a>
                </div>
            `).join('');
        }

        function loadLocations() {
            const container = document.getElementById('locationsGrid');
            if (!container) return;

            container.innerHTML = locations.map(loc => `
                <div class="location-card">
                    <div class="location-icon">${loc.icon}</div>
                    <h3>${loc.name}</h3>
                    <p>${loc.description}</p>
                    <div class="location-kwekers">${loc.kwekers} kweker(s) actief</div>
                </div>
            `).join('');
        }

        // ==========================================
        // Route Planner Functionality
        // ==========================================
        let routeStops = [];
        let routeType = 'bike';
        let routeLine = null;

        function setRouteType(type) {
            routeType = type;
            document.querySelectorAll('.route-type-btn').forEach(btn => btn.classList.remove('active'));
            document.getElementById('btn' + type.charAt(0).toUpperCase() + type.slice(1)).classList.add('active');
            updateRouteDisplay();
        }

        function addToRoute(name, lat, lng, icon) {
            if (routeStops.length >= 10) {
                showToast('Maximum 10 stops per route', 'warning');
                return;
            }
            
            // Check if already in route
            if (routeStops.find(s => s.name === name)) {
                showToast('Deze stop zit al in je route', 'info');
                return;
            }
            
            routeStops.push({ name, lat, lng, icon });
            updateRouteDisplay();
            showToast(`${name} toegevoegd aan route`, 'success');
        }

        function removeFromRoute(index) {
            routeStops.splice(index, 1);
            updateRouteDisplay();
        }

        function updateRouteDisplay() {
            const container = document.getElementById('routeStops');
            const summary = document.getElementById('routeSummary');
            
            if (routeStops.length === 0) {
                container.innerHTML = `<p style="text-align: center; color: var(--text-light); padding: 20px;">
                    Klik op markers in de kaart om stops toe te voegen aan je route
                </p>`;
                summary.style.display = 'none';
                if (routeLine) {
                    map.removeLayer(routeLine);
                    routeLine = null;
                }
                return;
            }
            
            container.innerHTML = routeStops.map((stop, i) => `
                <div class="route-stop" onclick="removeFromRoute(${i})" title="Klik om te verwijderen">
                    <div class="stop-number">${i + 1}</div>
                    <div class="stop-info">
                        <h4>${stop.icon} ${stop.name}</h4>
                        <p>Klik om te verwijderen</p>
                    </div>
                </div>
            `).join('');
            
            // Calculate route stats
            const distance = calculateRouteDistance();
            const time = calculateRouteTime(distance);
            
            document.getElementById('routeDistance').textContent = distance.toFixed(1) + ' km';
            document.getElementById('routeTime').textContent = time + ' min';
            document.getElementById('routeStopsCount').textContent = routeStops.length;
            
            summary.style.display = 'block';
            
            // Draw route line on map
            drawRouteLine();
        }

        function calculateRouteDistance() {
            if (routeStops.length < 2) return 0;
            
            let total = 0;
            for (let i = 0; i < routeStops.length - 1; i++) {
                const from = L.latLng(routeStops[i].lat, routeStops[i].lng);
                const to = L.latLng(routeStops[i + 1].lat, routeStops[i + 1].lng);
                total += from.distanceTo(to) / 1000; // Convert to km
            }
            return total * 1.3; // Add 30% for actual road distance
        }

        function calculateRouteTime(distanceKm) {
            const speeds = { bike: 15, car: 40, walk: 5 }; // km/h
            const stopTime = routeStops.length * 15; // 15 min per stop
            return Math.round((distanceKm / speeds[routeType]) * 60 + stopTime);
        }

        function drawRouteLine() {
            if (routeLine) {
                map.removeLayer(routeLine);
            }
            
            if (routeStops.length < 2) return;
            
            const coords = routeStops.map(s => [s.lat, s.lng]);
            routeLine = L.polyline(coords, {
                color: routeType === 'bike' ? '#27ae60' : routeType === 'car' ? '#3498db' : '#e74c3c',
                weight: 4,
                opacity: 0.8,
                dashArray: routeType === 'walk' ? '10, 10' : null
            }).addTo(map);
            
            map.fitBounds(routeLine.getBounds(), { padding: [50, 50] });
        }

        function clearRoute() {
            routeStops = [];
            updateRouteDisplay();
            showToast('Route gewist', 'info');
        }

        function exportRoute() {
            if (routeStops.length < 2) {
                showToast('Voeg minimaal 2 stops toe', 'warning');
                return;
            }
            
            // Generate simple GPX
            let gpx = `<?xml version="1.0" encoding="UTF-8"?>
<gpx version="1.1" creator="Bollenstreek Direct">
  <trk>
    <name>Bollenstreek Route</name>
    <trkseg>
${routeStops.map(s => `      <trkpt lat="${s.lat}" lon="${s.lng}"><name>${s.name}</name></trkpt>`).join('\n')}
    </trkseg>
  </trk>
</gpx>`;
            
            const blob = new Blob([gpx], { type: 'application/gpx+xml' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'bollenstreek-route.gpx';
            a.click();
            URL.revokeObjectURL(url);
            
            showToast('Route gedownload!', 'success');
        }

        // ==========================================
        // Live Bloom Status
        // ==========================================
        const bloomData = {
            tulpen: { start: 4, end: 5, peak: [4, 5] },
            narcissen: { start: 3, end: 5, peak: [3, 4] },
            hyacinten: { start: 3, end: 4, peak: [3, 4] },
            krokussen: { start: 2, end: 4, peak: [3] }
        };

        function updateBloomStatus() {
            const now = new Date();
            const month = now.getMonth() + 1; // 1-12
            
            let blooming = [];
            let upcoming = [];
            
            Object.entries(bloomData).forEach(([flower, data]) => {
                if (month >= data.start && month <= data.end) {
                    const isPeak = data.peak.includes(month);
                    blooming.push({ name: flower, isPeak });
                } else if (month === data.start - 1) {
                    upcoming.push(flower);
                }
            });
            
            const statusText = document.getElementById('bloomStatusText');
            const banner = document.getElementById('bloomStatusBanner');
            const indicator = banner.querySelector('.bloom-indicator');
            const bestVisit = document.getElementById('bestVisitTime');
            
            if (blooming.length > 0) {
                const peakFlowers = blooming.filter(f => f.isPeak).map(f => f.name);
                if (peakFlowers.length > 0) {
                    statusText.textContent = `üå∏ Piek bloei: ${peakFlowers.join(', ')}! Nu is het ideale moment om te bezoeken.`;
                } else {
                    statusText.textContent = `In bloei: ${blooming.map(f => f.name).join(', ')}`;
                }
                indicator.className = 'bloom-indicator active';
                bestVisit.textContent = 'NU!';
            } else if (upcoming.length > 0) {
                statusText.textContent = `Binnenkort in bloei: ${upcoming.join(', ')}. Nog even geduld!`;
                indicator.className = 'bloom-indicator upcoming';
                banner.style.background = 'linear-gradient(135deg, #fff3e0 0%, #ffe0b2 100%)';
                bestVisit.textContent = 'Maart - Mei';
            } else if (month >= 6 && month <= 9) {
                statusText.textContent = 'Zomerbollen zoals lelies en dahlia\'s zijn nu in bloei!';
                indicator.className = 'bloom-indicator active';
                bestVisit.textContent = 'Juni - September';
            } else {
                statusText.textContent = 'Het bollenseizoen is voorbij. Bestel nu bollen voor het voorjaar!';
                indicator.className = 'bloom-indicator finished';
                banner.style.background = 'var(--bg-light)';
                bestVisit.textContent = 'Maart - Mei 2025';
            }
        }

        // Update popup content to include "add to route" button
        function createKwekerPopup(kweker) {
            return `
                <div class="popup-kweker">
                    <div style="font-size: 2rem; margin-bottom: 5px;">${kweker.avatar}</div>
                    <h3>${kweker.name}</h3>
                    <div class="location">üìç ${kweker.location}</div>
                    <div class="specialties">
                        ${kweker.specialties.map(s => `<span class="specialty">${s}</span>`).join('')}
                    </div>
                    <div style="font-size: 0.85rem; color: #7f8c8d; margin-bottom: 10px;">
                        Sinds ${kweker.since} ‚Ä¢ ‚≠ê ${kweker.rating}
                    </div>
                    <div style="display: flex; gap: 5px; flex-wrap: wrap; justify-content: center;">
                        ${kweker.website ? `<a href="${kweker.website}" target="_blank" class="btn-small">üåê Website</a>` : ''}
                        <button class="btn-small" style="background: #27ae60;" onclick="addToRoute('${kweker.name}', ${kweker.coordinates.lat}, ${kweker.coordinates.lng}, '${kweker.avatar}')">‚ûï Route</button>
                    </div>
                </div>
            `;
        }

        // Initialize bloom status on load
        document.addEventListener('DOMContentLoaded', function() {
            updateBloomStatus();
        });
    </script>

    <!-- Toast Container -->
    <div class="toast-container" id="toastContainer"></div>

    <script src="js/favorites.js"></script>
    <script src="js/search.js"></script>
    <script src="js/translations.js"></script>
</body>
</html>
